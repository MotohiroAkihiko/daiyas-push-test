<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content:">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">

  <meta name="theme-color" content="#007aff">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <title>DaiyasMobile</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="static/icons/top_menu_logo.png">
  <link rel="icon" href="static/icons/top_menu_logo.png">
  <link rel="manifest" href="/manifest.json">
  <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDjbILwGLrqFUEJkExXVyUemxu_oJ4wZbg",
      authDomain: "natyuraru-push.firebaseapp.com",
      databaseURL: "https://natyuraru-push.firebaseio.com",
      projectId: "natyuraru-push",
      storageBucket: "natyuraru-push.appspot.com",
      messagingSenderId: "89168151507",
      appId: "1:89168151507:web:db0836569afc7566086526",
      measurementId: "G-JWVKG6QF1L"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <script>
    const messaging = firebase.messaging();
    
    if ('serviceWorker' in navigator) {
        // サービスワーカー登録
        navigator.serviceWorker.register('./service-worker.js').then(function(registration) {
            // 成功した場合の処理
            console.log('サービスワーカーを登録しました。', registration.scope);
            // 登録処理
            messaging.useServiceWorker(registration);
            // 通知の受信許可確認
            messaging.requestPermission()
                     .then(function() {
                         console.log('通知の受信が許可されました。');
                         // トークンを取得する
                         messaging.getToken()
                                  .then(function(currentToken) {
                                      if (currentToken) {
                                          // 通知許可を押下した場合、トークンをコンソール出力
                                          //ここは後でDBへ格納する処理などに変更しておきましょう
                                          console.log(currentToken);
                                      } else {
                                          console.log('トークンを取得できませんでした。権限を確認してください。');
                                      }
                                  })
                                  .catch(function(err) {
                                      console.log('トークンの取得中にエラーが発生しました。', err);
                                  });
                     })
                     .catch(function(err) {
                         console.log('通知が許可されていません。', err);
                     });
        }).catch(function(err) {
            // サービスワーカー登録失敗
            console.log('サービスワーカーの登録に失敗しました。', err);
        });
    }
  </script>

</head>
<body>
  <div id="app"></div>
<script src="js/app.js"></script></body>
</html>